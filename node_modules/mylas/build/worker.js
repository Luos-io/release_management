"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const worker_threads_1 = require("worker_threads");
const index_1 = require("./index");
worker_threads_1.parentPort.once("message", async ({ method, path, data }) => {
    try {
        if (method === index_1.Method.loadFile)
            worker_threads_1.parentPort.postMessage(await index_1.File.load(path));
        if (method === index_1.Method.saveFile)
            await index_1.File.save(path, data);
        if (method === index_1.Method.loadJson)
            worker_threads_1.parentPort.postMessage(await index_1.Json.load(path));
        if (method === index_1.Method.loadJsonComments)
            worker_threads_1.parentPort.postMessage(await index_1.Json.load(path, undefined, true));
        if (method === index_1.Method.saveJson)
            await index_1.Json.save(path, data);
        if (method === index_1.Method.saveBuffer)
            await index_1.Buf.save(path, Buffer.from(data));
        if (method === index_1.Method.loadBuffer) {
            const data = await index_1.Buf.load(path);
            const sharedUint8Array = new Uint8Array(new SharedArrayBuffer(data.byteLength));
            sharedUint8Array.set(data);
            worker_threads_1.parentPort.postMessage(sharedUint8Array);
        }
        setTimeout(process.exit(0), 10);
    }
    catch (error) {
        process.exit(1);
    }
});
