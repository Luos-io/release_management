{"version":3,"file":"path.js","sourceRoot":"","sources":["../../src/helpers/path.ts"],"names":[],"mappings":"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","sourcesContent":["import { sync } from 'globby';\nimport { normalize, relative } from 'path';\nimport {\n  AliasPath,\n  IProjectConfig,\n  PathLike,\n  StringReplacer\n} from '../interfaces';\nimport * as normalizePath from 'normalize-path';\n\nexport const mapPaths = (paths: PathLike, mapper: StringReplacer): PathLike => {\n  const dest = {} as PathLike;\n  Object.keys(paths).forEach((key) => {\n    dest[key] = paths[key].map(mapper);\n  });\n  return dest;\n};\n\nexport function getProjectDirPathInOutDir(\n  outDir: string,\n  projectDir: string\n): string | undefined {\n  const dirs = sync(\n    [\n      `${outDir}/**/${projectDir}`,\n      `!${outDir}/**/${projectDir}/**/${projectDir}`,\n      `!${outDir}/**/node_modules`\n    ],\n    {\n      dot: true,\n      onlyDirectories: true\n    }\n  );\n\n  // Find the longest path\n  return dirs.reduce(\n    (prev, curr) =>\n      prev.split('/').length > curr.split('/').length ? prev : curr,\n    dirs[0]\n  );\n}\n\n/**\n * relativeOutPathToConfigDir\n * Finds relative path access of configDir in outPath\n */\nexport function relativeOutPathToConfigDir(config: IProjectConfig) {\n  config.configDirInOutPath = getProjectDirPathInOutDir(\n    config.outPath,\n    config.confDirParentFolderName\n  );\n\n  // Find relative path access of configDir in outPath\n  if (config.configDirInOutPath) {\n    config.hasExtraModule = true;\n    const stepsbackPath = relative(config.configDirInOutPath, config.outPath);\n    const splitStepBackPath = normalizePath(stepsbackPath).split('/');\n    const nbOfStepBack = splitStepBackPath.length;\n    const splitConfDirInOutPath = config.configDirInOutPath.split('/');\n\n    let i = 1;\n    const splitRelPath: string[] = [];\n    while (i <= nbOfStepBack) {\n      splitRelPath.unshift(\n        splitConfDirInOutPath[splitConfDirInOutPath.length - i]\n      );\n      i++;\n    }\n    config.relConfDirPathInOutPath = splitRelPath.join('/');\n  }\n}\n\n/**\n * findBasePathOfAlias finds a basepath for every AliasPath.\n * And checks if isExtra should be true or false.\n * @param aliasPath The alias path.\n * @param config config object with all config values.\n */\nexport function findBasePathOfAlias(config: IProjectConfig) {\n  return (path: string) => {\n    const aliasPath = { path } as AliasPath;\n    if (normalize(aliasPath.path).includes('..')) {\n      const tempBasePath = normalizePath(\n        normalize(\n          `${config.configDir}/${config.outDir}/` +\n            `${\n              config.hasExtraModule && config.relConfDirPathInOutPath\n                ? config.relConfDirPathInOutPath\n                : ''\n            }/${config.baseUrl}`\n        )\n      );\n\n      const absoluteBasePath = normalizePath(\n        normalize(`${tempBasePath}/${aliasPath.path}`)\n      );\n      if (config.pathCache.existsResolvedAlias(absoluteBasePath)) {\n        aliasPath.isExtra = false;\n        aliasPath.basePath = tempBasePath;\n      } else {\n        aliasPath.isExtra = true;\n        aliasPath.basePath = absoluteBasePath;\n      }\n    } else if (config.hasExtraModule) {\n      aliasPath.isExtra = false;\n      aliasPath.basePath = normalizePath(\n        normalize(\n          `${config.configDir}/${config.outDir}/` +\n            `${config.relConfDirPathInOutPath}/${config.baseUrl}`\n        )\n      );\n    } else {\n      aliasPath.basePath = normalizePath(\n        normalize(`${config.configDir}/${config.outDir}`)\n      );\n      aliasPath.isExtra = false;\n    }\n    return aliasPath;\n  };\n}\n"]}